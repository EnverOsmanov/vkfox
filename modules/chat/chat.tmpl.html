<navigation></navigation>
<item-list class="chat" ng-controller="ChatCtrl">
    <item
        class="{{dialog.author && 'chat__item_out'}}"
        item-list-repeat="dialog in data track by dialog.id"
        owners="dialog.owners">
        <!-- overwrite title from item-send-message directive -->
        <blockquote
            item-send-message
            title=""
            chat-id="dialog.chat_id"
            uid="dialog.uid"
            class="chat__item-content">
            <p ng-repeat="message in dialog.messages">
                <span ng-bind-html-unsafe="message.body | rectify:message.emoji"></span>
                <!-- line break before photos etc -->
                <br ng-if="message.attachments"/>
                <item-attachment
                    ng-repeat="attachment in message.attachments"
                    data="attachment[attachment.type]"
                    type="{{attachment.type}}">
                </item-attachment>
            </p>
            <small class="chat__author" ng-if="dialog.author">{{dialog.author | name}}</small>
        </blockquote>
        <item-actions>
            <!-- link to dialog -->
            <item-action
                anchor="{{'http://vk.com/im?sel=' + (dialog.chat_id ? 'c' + dialog.chat_id:dialog.uid)}}"
                ng-class="'icon-external-link-sign'">
            </item-action>
            <item-action
                item-send-message
                chat-id="dialog.chat_id"
                uid="dialog.uid"
                ng-class="'icon-envelope'">
            </item-action>
            <item-action
                ng-class="'chat__item-action_mark-read icon-bookmark'"
                ng-if="dialog.isUnread"
                ng-click="dialog.unreadHandler(dialog.messages, $event)"
                title="{{dialog.unreadTooltip}}">
            </item-action>
        </item-actions>
    </item>
</item-list>
